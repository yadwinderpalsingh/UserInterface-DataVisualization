<!DOCTYPE HTML>
<html>

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Highcharts Example</title>

    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
    <link href="style.css" rel="stylesheet">
    <link href="slider.css" rel="stylesheet">
    <style type="text/css">
        #container {
            height: calc(100% - 80px);
            padding: 30px;
            width: 100%;
            margin: 0 auto;
        }
        
        html,
        body {
            height: 100%;
            width: 100%;
        }
        
        body {
            overflow: hidden;
            margin: 0;
        }
        
        * {
            box-sizing: border-box
        }
    </style>
    <script type="text/javascript">
        var age = [];
        var gender = ["male", "female"];

        $(function () {

            var options = {
                chart: {
                    //renderTo: 'container',
                    type: 'column'
                    , options3d: {
                        enabled: true
                        , alpha: 15
                        , beta: 15
                        , viewDistance: 25
                        , depth: 40
                    }
                }
                , xAxis: {
                    categories: []
                },

                yAxis: {
                    min: 0
                    , title: {
                        text: 'Age'
                    }
                },

                tooltip: {
                    headerFormat: '<b>{point.key}</b><br>'
                    , pointFormat: '<span style="color:{series.color}">\u25CF</span> {series.name}: {point.y} / {point.stackTotal}'
                },

                plotOptions: {
                    column: {
                        stacking: 'normal'
                        , depth: 40
                    }
                }
                , series: []
            };

            readDataFile(2000, options);

        });

        function readDataFile(year, options) {
            var obj = {};
            $.get('population.csv', function (data) {

                // Split the lines
                var lines = data.split('\n');

                var maleobj = {
                    name: "Male"
                    , data: []
                    , stack: "male"
                };

                var femaleobj = {
                    name: "Female"
                    , data: []
                    , stack: "female"
                };

                $.each(lines, function (lineNo, line) {
                    var items = line.split(',');

                    // header line containes categories
                    if (lineNo == 0) {
                        //						$.each(items, function(itemNo, item) {
                        //							if (itemNo > 0) options.xAxis.categories.push(item);
                        //						});
                    } else {
                        // age groups
                        if (age.length < 19) {
                            if (age.length == 0) {
                                age.push(parseInt(items[1]));
                            } else {
                                if (age[age.length - 1] !== parseInt(items[1])) {
                                    age.push(parseInt(items[1]));
                                }
                            }
                        }

                        // data by selected year
                        if (parseInt(items[0]) === year && items[2] === gender[0]) {
                            maleobj.data.push(parseInt(items[3]));
                        } else if (parseInt(items[0]) === year) {
                            femaleobj.data.push(parseInt(items[3]));
                        }

                        //                     
                    }

                });

                options.xAxis.categories = age;
                options.series.push(maleobj);
                options.series.push(femaleobj);
                $('#container').highcharts(options);
            });
        }
    </script>
</head>

<body>


    <script src="https://code.highcharts.com/highcharts.js"></script>
    <script src="https://code.highcharts.com/highcharts-3d.js"></script>
    <script src="https://code.highcharts.com/modules/exporting.js"></script>


    <div id="container"></div>
    <div class="filter">
        <input id="yearslider" type="text" data-provide="slider" data-slider-ticks="[1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15]" data-slider-ticks-labels='["1860", "1870", "1880", "1890", "1900", "1910", "1920", "1930", "1940", "1950", "1960", "1970", "1980", "1990", "2000" ]' data-slider-min="1" data-slider-max="1" data-slider-step="1" data-slider-value="15" data-slider-tooltip="hide" style="width:100%">
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-slider/9.1.3/bootstrap-slider.min.js"></script>

</body>

</html>